<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>Dion</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="Dion" href="http://jsonzhang.github.io/feed.xml" />
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <!--[if IE 8]><link rel="stylesheet" href="/assets/css/ie.css"><![endif]-->
    <link rel="canonical" href="http://jsonzhang.github.io/blog/charles-debug/">

    <!-- Modernizr -->
    <script src="/assets/js/modernizr.custom.15390.js" type="text/javascript"></script>

</head>

<body>
   <div class="content">
      <div class="container">
         <div class="post">
  
  <h1 class="postTitle">chales调试进阶</h1>
  <p class="meta">October 15, 2015 | <span class="time">0</span> Minute Read</p>
  
  <p>Charles是OS X系统上一个非常好用的抓包软件(因为Fiddler没有Mac版)，而在抓包时候遇到一些比较特殊的情况，在这里记录下来。关于Charles如何抓去常规的http协议包已经有很多的教程。</p>

<p>以下总结 charles 抓取 Mac 本机的包和如何抓取手机上https的包。</p>

<ol>
<li><p>抓取本机 http 的包
 Mac下抓取本机http的请求包只需要在浏览器中配置好相关的代理，建议使用chrome浏览器，安装 <a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif">SwitchyOmega</a> 这个 chrome 插件 (类似的切换代理插件也可以)，并且将代理的请求到 charles 配置好的 127.0.0.1:8888 即可。<br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/1.png" alt=""></p></li>
<li><p>抓取本机 https 的包
需要勾选<code>proxy setting</code> 下 ssl tab的 <code>enable ssl proxying</code> ， 并将监听的主机设置为<code>*</code>， 表示监听本机所有https网络流量。<br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/2.png" alt="">
接下来需要安装 charles 的一个SSL 根证书。<br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/3.png" alt="">
并信任该根证书。</p></li>
<li><p>如果在局域网(如公司专有网络下)下调试 本机 http 或 https
设置同 『抓取本机 https 的包』 ，需要多加一项，在 <code>external proxy setting</code> 中 勾选 <code>use external proxy servers</code> 并设置如下。
<img src="../../assets/articleImage/2015-10-12-charles-debug/4.png" alt=""><br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/5.png" alt="">           </p></li>
<li><p>同一网段下调试手机的 https 请求。
需要用手机访问 http://www.charlesproxy.com/documentation/additional/legacy-ssl-proxying/ (该页面貌似需要挂着charles代理才能正常访问)，即手机需要手动挂http代理到电脑的IP地址，在网络设置中查看Mac机地址。
然后点击下载证书本身，会弹出一个需要安装信任证书的页面，安装成功后即可用charles调试https。<br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/6.png" alt=""><br>
然后步骤同调试http， 如果出现 &quot;charles ssl host name lookup failure” 表示证书安装不成功。</p></li>
<li><p>抓取 x-code 模拟器 中的 https 请求包。(需要在 charles 3.9.3版本以上)
<code>help</code> - <code>install charles CA SSL Certificate in IOS Simulators</code>
<img src="../../assets/articleImage/2015-10-12-charles-debug/7.png" alt=""></p></li>
<li><p>如果需要抓取本机除浏览器外的其他软件发出的网络请求包，则需要勾选下面这个地方。
<img src="../../assets/articleImage/2015-10-12-charles-debug/8.png" alt=""><br>
同理勾选下面这个地方亦可。<br>
<img src="../../assets/articleImage/2015-10-12-charles-debug/9.png" alt=""></p></li>
</ol>



  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'jsonzhanggithubio';
      
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  


  <!-- POST NAVIGATION -->
  <div class="postNav clearfix">
     
      <a class="prev" href="/blog/Mac-change-proxy/"><span>&laquo;&nbsp;Mac代理切换</span>
      
    </a>
      
     
  </div>

</div>

      </div>
   </div><!-- end .content -->
   <!-- include footer.html -->
   <!-- Add jQuery and other scripts -->
<script src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-1.10.2.min.js"></script>
<script>window.jQuery || document.write('<script src=""><\/script>')</script>
<script src="/assets/js/dropcap.min.js"></script>
<script src="/assets/js/scripts.js"></script>

</body>
</html>